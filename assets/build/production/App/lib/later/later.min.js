later=function(){var a={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(f){if(null==this){throw new TypeError}var c=Object(this),g=c.length>>>0;if(0===g){return -1}var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=g){return -1}for(var b=d>=0?d:Math.max(g-Math.abs(d),0);g>b;b++){if(b in c&&c[b]===f){return b}}return -1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a.array={},a.array.sort=function(c,b){c.sort(function(f,d){return +f-+d}),b&&0===c[0]&&c.push(c.shift())},a.array.next=function(h,f,j){for(var g,b=0!==j[0],d=0,c=f.length-1;c>-1;--c){if(g=f[c],g===h){return g}if(!(g>h||0===g&&b&&j[1]>h)){break}d=c}return f[d]},a.array.nextInvalid=function(k,q,g){for(var b=g[0],m=g[1],h=q.length,p=0===q[h-1]&&0!==b?m:0,c=k,j=q.indexOf(k),l=c;c===(q[j]||p);){if(c++,c>m&&(c=b),j++,j===h&&(j=0),c===l){return}}return c},a.array.prev=function(h,f,k){for(var g,b=f.length,d=0!==k[0],c=b-1,j=0;b>j;j++){if(g=f[j],g===h){return g}if(!(h>g||0===g&&d&&k[1]<h)){break}c=j}return f[c]},a.array.prevInvalid=function(k,q,g){for(var b=g[0],m=g[1],h=q.length,p=0===q[h-1]&&0!==b?m:0,c=k,j=q.indexOf(k),l=c;c===(q[j]||p);){if(c--,b>c&&(c=m),j--,-1===j&&(j=h-1),c===l){return}}return c},a.day=a.D={name:"day",range:86400,val:function(b){return b.D||(b.D=a.date.getDate.call(b))},isValid:function(b,c){return a.D.val(b)===(c||a.D.extent(b)[1])},extent:function(b){if(b.DExtent){return b.DExtent}var d=a.M.val(b),c=a.DAYS_IN_MONTH[d-1];return 2===d&&366===a.dy.extent(b)[1]&&(c+=1),b.DExtent=[1,c]},start:function(b){return b.DStart||(b.DStart=a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b)))},end:function(b){return b.DEnd||(b.DEnd=a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b)))},next:function(c,e){e=e>a.D.extent(c)[1]?1:e;var d=a.date.nextRollover(c,e,a.D,a.M),b=a.D.extent(d)[1];return e=e>b?1:e||b,a.date.next(a.Y.val(d),a.M.val(d),e)},prev:function(c,e){var d=a.date.prevRollover(c,e,a.D,a.M),b=a.D.extent(d)[1];return a.date.prev(a.Y.val(d),a.M.val(d),e>b?b:e||b)}},a.dayOfWeekCount=a.dc={name:"day of week count",range:604800,val:function(b){return b.dc||(b.dc=Math.floor((a.D.val(b)-1)/7)+1)},isValid:function(b,c){return a.dc.val(b)===c||0===c&&a.D.val(b)>a.D.extent(b)[1]-7},extent:function(b){return b.dcExtent||(b.dcExtent=[1,Math.ceil(a.D.extent(b)[1]/7)])},start:function(b){return b.dcStart||(b.dcStart=a.date.next(a.Y.val(b),a.M.val(b),Math.max(1,7*(a.dc.val(b)-1)+1||1)))},end:function(b){return b.dcEnd||(b.dcEnd=a.date.prev(a.Y.val(b),a.M.val(b),Math.min(7*a.dc.val(b),a.D.extent(b)[1])))},next:function(d,f){f=f>a.dc.extent(d)[1]?1:f;var e=a.date.nextRollover(d,f,a.dc,a.M),b=a.dc.extent(e)[1];f=f>b?1:f;var c=a.date.next(a.Y.val(e),a.M.val(e),0===f?a.D.extent(e)[1]-6:1+7*(f-1));return c.getTime()<=d.getTime()?(e=a.M.next(d,a.M.val(d)+1),a.date.next(a.Y.val(e),a.M.val(e),0===f?a.D.extent(e)[1]-6:1+7*(f-1))):c},prev:function(c,e){var d=a.date.prevRollover(c,e,a.dc,a.M),b=a.dc.extent(d)[1];return e=e>b?b:e||b,a.dc.end(a.date.prev(a.Y.val(d),a.M.val(d),1+7*(e-1)))}},a.dayOfWeek=a.dw=a.d={name:"day of week",range:86400,val:function(b){return b.dw||(b.dw=a.date.getDay.call(b)+1)},isValid:function(b,c){return a.dw.val(b)===(c||7)},extent:function(){return[1,7]},start:function(b){return a.D.start(b)},end:function(b){return a.D.end(b)},next:function(b,c){return c=c>7?1:c||7,a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b)+(c-a.dw.val(b))+(c<=a.dw.val(b)?7:0))},prev:function(b,c){return c=c>7?7:c||7,a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b)+(c-a.dw.val(b))+(c>=a.dw.val(b)?-7:0))}},a.dayOfYear=a.dy={name:"day of year",range:86400,val:function(b){return b.dy||(b.dy=Math.ceil(1+(a.D.start(b).getTime()-a.Y.start(b).getTime())/a.DAY))},isValid:function(b,c){return a.dy.val(b)===(c||a.dy.extent(b)[1])},extent:function(b){var c=a.Y.val(b);return b.dyExtent||(b.dyExtent=[1,c%4?365:366])},start:function(b){return a.D.start(b)},end:function(b){return a.D.end(b)},next:function(c,e){e=e>a.dy.extent(c)[1]?1:e;var d=a.date.nextRollover(c,e,a.dy,a.Y),b=a.dy.extent(d)[1];return e=e>b?1:e||b,a.date.next(a.Y.val(d),a.M.val(d),e)},prev:function(c,e){var d=a.date.prevRollover(c,e,a.dy,a.Y),b=a.dy.extent(d)[1];return e=e>b?b:e||b,a.date.prev(a.Y.val(d),a.M.val(d),e)}},a.hour=a.h={name:"hour",range:3600,val:function(b){return b.h||(b.h=a.date.getHour.call(b))},isValid:function(b,c){return a.h.val(b)===c},extent:function(){return[0,23]},start:function(b){return b.hStart||(b.hStart=a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b),a.h.val(b)))},end:function(b){return b.hEnd||(b.hEnd=a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b),a.h.val(b)))},next:function(b,d){d=d>23?0:d;var c=a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b)+(d<=a.h.val(b)?1:0),d);return !a.date.isUTC&&c.getTime()<=b.getTime()&&(c=a.date.next(a.Y.val(c),a.M.val(c),a.D.val(c),d+1)),c},prev:function(b,c){return c=c>23?23:c,a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b)+(c>=a.h.val(b)?-1:0),c)}},a.minute=a.m={name:"minute",range:60,val:function(b){return b.m||(b.m=a.date.getMin.call(b))},isValid:function(b,c){return a.m.val(b)===c},extent:function(b){return[0,59]},start:function(b){return b.mStart||(b.mStart=a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b),a.h.val(b),a.m.val(b)))},end:function(b){return b.mEnd||(b.mEnd=a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b),a.h.val(b),a.m.val(b)))},next:function(e,g){var f=a.m.val(e),b=a.s.val(e),d=g>59?60-f:f>=g?60-f+g:g-f,c=new Date(e.getTime()+d*a.MIN-b*a.SEC);return !a.date.isUTC&&c.getTime()<=e.getTime()&&(c=new Date(e.getTime()+(d+120)*a.MIN-b*a.SEC)),c},prev:function(b,c){return c=c>59?59:c,a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b),a.h.val(b)+(c>=a.m.val(b)?-1:0),c)}},a.month=a.M={name:"month",range:2629740,val:function(b){return b.M||(b.M=a.date.getMonth.call(b)+1)},isValid:function(b,c){return a.M.val(b)===(c||12)},extent:function(){return[1,12]},start:function(b){return b.MStart||(b.MStart=a.date.next(a.Y.val(b),a.M.val(b)))},end:function(b){return b.MEnd||(b.MEnd=a.date.prev(a.Y.val(b),a.M.val(b)))},next:function(b,c){return c=c>12?1:c||12,a.date.next(a.Y.val(b)+(c>a.M.val(b)?0:1),c)},prev:function(b,c){return c=c>12?12:c||12,a.date.prev(a.Y.val(b)-(c>=a.M.val(b)?1:0),c)}},a.second=a.s={name:"second",range:1,val:function(b){return b.s||(b.s=a.date.getSec.call(b))},isValid:function(b,c){return a.s.val(b)===c},extent:function(){return[0,59]},start:function(b){return b},end:function(b){return b},next:function(d,f){var e=a.s.val(d),b=f>59?60-e:e>=f?60-e+f:f-e,c=new Date(d.getTime()+b*a.SEC);return !a.date.isUTC&&c.getTime()<=d.getTime()&&(c=new Date(d.getTime()+(b+7200)*a.SEC)),c},prev:function(b,d,c){return d=d>59?59:d,a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b),a.h.val(b),a.m.val(b)+(d>=a.s.val(b)?-1:0),d)}},a.time=a.t={name:"time",range:1,val:function(b){return b.t||(b.t=3600*a.h.val(b)+60*a.m.val(b)+a.s.val(b))},isValid:function(b,c){return a.t.val(b)===c},extent:function(){return[0,86399]},start:function(b){return b},end:function(b){return b},next:function(b,d){d=d>86399?0:d;var c=a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b)+(d<=a.t.val(b)?1:0),0,0,d);return !a.date.isUTC&&c.getTime()<b.getTime()&&(c=a.date.next(a.Y.val(c),a.M.val(c),a.D.val(c),a.h.val(c),a.m.val(c),d+7200)),c},prev:function(b,c){return c=c>86399?86399:c,a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b)+(c>=a.t.val(b)?-1:0),0,0,c)}},a.weekOfMonth=a.wm={name:"week of month",range:604800,val:function(b){return b.wm||(b.wm=(a.D.val(b)+(a.dw.val(a.M.start(b))-1)+(7-a.dw.val(b)))/7)},isValid:function(b,c){return a.wm.val(b)===(c||a.wm.extent(b)[1])},extent:function(b){return b.wmExtent||(b.wmExtent=[1,(a.D.extent(b)[1]+(a.dw.val(a.M.start(b))-1)+(7-a.dw.val(a.M.end(b))))/7])},start:function(b){return b.wmStart||(b.wmStart=a.date.next(a.Y.val(b),a.M.val(b),Math.max(a.D.val(b)-a.dw.val(b)+1,1)))},end:function(b){return b.wmEnd||(b.wmEnd=a.date.prev(a.Y.val(b),a.M.val(b),Math.min(a.D.val(b)+(7-a.dw.val(b)),a.D.extent(b)[1])))},next:function(c,e){e=e>a.wm.extent(c)[1]?1:e;var d=a.date.nextRollover(c,e,a.wm,a.M),b=a.wm.extent(d)[1];return e=e>b?1:e||b,a.date.next(a.Y.val(d),a.M.val(d),Math.max(1,7*(e-1)-(a.dw.val(d)-2)))},prev:function(c,e){var d=a.date.prevRollover(c,e,a.wm,a.M),b=a.wm.extent(d)[1];return e=e>b?b:e||b,a.wm.end(a.date.next(a.Y.val(d),a.M.val(d),Math.max(1,7*(e-1)-(a.dw.val(d)-2))))}},a.weekOfYear=a.wy={name:"week of year (ISO)",range:604800,val:function(b){if(b.wy){return b.wy}var d=a.dw.next(a.wy.start(b),5),c=a.dw.next(a.Y.prev(d,a.Y.val(d)-1),5);return b.wy=1+Math.ceil((d.getTime()-c.getTime())/a.WEEK)},isValid:function(b,c){return a.wy.val(b)===(c||a.wy.extent(b)[1])},extent:function(c){if(c.wyExtent){return c.wyExtent}var e=a.dw.next(a.wy.start(c),5),d=a.dw.val(a.Y.start(e)),b=a.dw.val(a.Y.end(e));return c.wyExtent=[1,5===d||5===b?53:52]},start:function(b){return b.wyStart||(b.wyStart=a.date.next(a.Y.val(b),a.M.val(b),a.D.val(b)-(a.dw.val(b)>1?a.dw.val(b)-2:6)))},end:function(b){return b.wyEnd||(b.wyEnd=a.date.prev(a.Y.val(b),a.M.val(b),a.D.val(b)+(a.dw.val(b)>1?8-a.dw.val(b):0)))},next:function(e,g){g=g>a.wy.extent(e)[1]?1:g;var f=a.dw.next(a.wy.start(e),5),b=a.date.nextRollover(f,g,a.wy,a.Y);1!==a.wy.val(b)&&(b=a.dw.next(b,2));var d=a.wy.extent(b)[1],c=a.wy.start(b);return g=g>d?1:g||d,a.date.next(a.Y.val(c),a.M.val(c),a.D.val(c)+7*(g-1))},prev:function(e,g){var f=a.dw.next(a.wy.start(e),5),b=a.date.prevRollover(f,g,a.wy,a.Y);1!==a.wy.val(b)&&(b=a.dw.next(b,2));var d=a.wy.extent(b)[1],c=a.wy.end(b);return g=g>d?d:g||d,a.wy.end(a.date.next(a.Y.val(c),a.M.val(c),a.D.val(c)+7*(g-1)))}},a.year=a.Y={name:"year",range:31556900,val:function(b){return b.Y||(b.Y=a.date.getYear.call(b))},isValid:function(b,c){return a.Y.val(b)===c},extent:function(){return[1970,2099]},start:function(b){return b.YStart||(b.YStart=a.date.next(a.Y.val(b)))},end:function(b){return b.YEnd||(b.YEnd=a.date.prev(a.Y.val(b)))},next:function(b,c){return c>a.Y.val(b)&&c<=a.Y.extent()[1]?a.date.next(c):a.NEVER},prev:function(b,c){return c<a.Y.val(b)&&c>=a.Y.extent()[0]?a.date.prev(c):a.NEVER}},a.fullDate=a.fd={name:"full date",range:1,val:function(b){return b.fd||(b.fd=b.getTime())},isValid:function(b,c){return a.fd.val(b)===c},extent:function(){return[0,32503680000000]},start:function(b){return b},end:function(b){return b},next:function(b,c){return a.fd.val(b)<c?new Date(c):a.NEVER},prev:function(b,c){return a.fd.val(b)>c?new Date(c):a.NEVER}},a.modifier={},a.modifier.after=a.modifier.a=function(c,b){var d=b[0];return{name:"after "+c.name,range:(c.extent(new Date)[1]-d)*c.range,val:c.val,isValid:function(g,f){return this.val(g)>=d},extent:c.extent,start:c.start,end:c.end,next:function(e,f){return f!=d&&(f=c.extent(e)[0]),c.next(e,f)},prev:function(e,f){return f=f===d?c.extent(e)[1]:d-1,c.prev(e,f)}}},a.modifier.before=a.modifier.b=function(c,b){var d=b[b.length-1];return{name:"before "+c.name,range:c.range*(d-1),val:c.val,isValid:function(g,f){return this.val(g)<d},extent:c.extent,start:c.start,end:c.end,next:function(e,f){return f=f===d?c.extent(e)[0]:d,c.next(e,f)},prev:function(e,f){return f=f===d?d-1:c.extent(e)[1],c.prev(e,f)}}},a.compile=function(s){function e(d){return"next"===d?function(i,f){return i.getTime()>f.getTime()}:function(i,f){return f.getTime()>i.getTime()}}var b,m=[],h=0;for(var q in s){var c=q.split("_"),j=c[0],k=c[1],p=s[q],g=k?a.modifier[k](a[j],p):a[j];m.push({constraint:g,vals:p}),h++}return m.sort(function(i,d){var l=i.constraint.range,f=d.constraint.range;return l>f?-1:f>l?1:0}),b=m[h-1].constraint,{start:function(D,r){for(var C,i=r,y=a.array[D],z=1000;z--&&!C&&i;){C=!0;for(var B=0;h>B;B++){var x=m[B].constraint,A=x.val(i),E=x.extent(i),w=y(A,m[B].vals,E);if(!x.isValid(i,w)){i=x[D](i,w),C=!1;break}}}return i!==a.NEVER&&(i="next"===D?b.start(i):b.end(i)),i},end:function(D,i){for(var C,n=a.array[D+"Invalid"],y=e(D),z=h-1;z>=0;z--){var B,x=m[z].constraint,A=x.val(i),E=x.extent(i),w=n(A,m[z].vals,E);void 0!==w&&(B=x[D](i,w),!B||C&&!y(C,B)||(C=B))}return C},tick:function(d,f){return new Date("next"===d?b.end(f).getTime()+a.SEC:b.start(f).getTime()-a.SEC)},tickStart:function(d){return b.start(d)}}},a.schedule=function(z){function E(y,aa,v,ac,Z){var P,s,ad,c=A(y),ab=aa,w=1000,i=[],o=[],l=[],r="next"===y,m=r?0:1,Q=r?1:0;if(v=v?new Date(v):new Date,!v||!v.getTime()){throw new Error("Invalid start date.")}for(N(y,I,i,v),q(y,j,o,v);w--&&ab&&(P=F(i,c))&&(!ac||!c(P,ac));){if(b&&(D(y,j,o,P),s=k(y,o,P))){H(y,I,i,s)}else{if(Z){var f=G(o,c);s=M(y,I,i,P,f);var u=r?[new Date(Math.max(v,P)),s?new Date(ac?Math.min(s,ac):s):void 0]:[s?new Date(ac?Math.max(ac,s.getTime()+a.SEC):s.getTime()+a.SEC):void 0,new Date(Math.min(v,P.getTime()+a.SEC))];if(ad&&u[m].getTime()===ad[Q].getTime()?(ad[Q]=u[Q],ab++):(ad=u,l.push(ad)),!s){break}H(y,I,i,s)}else{l.push(r?new Date(Math.max(v,P)):L(I,i,P,ac)),K(y,I,i,P)}ab--}}for(var h=0,X=l.length;X>h;h++){var d=l[h];l[h]="[object Array]"===Object.prototype.toString.call(d)?[B(d[0]),B(d[1])]:B(d)}return 0===l.length?a.NEVER:1===aa?l[0]:l}function B(c){return c instanceof Date&&!isNaN(c.valueOf())?new Date(c):void 0}function N(h,f,l,g){for(var c=0,d=f.length;d>c;c++){l[c]=f[c].start(h,g)}}function H(l,g,m,h){for(var c=A(l),f=0,d=g.length;d>f;f++){m[f]&&!c(m[f],h)&&(m[f]=g[f].start(l,h))}}function q(g,m,h,c){for(var f=(A(g),0),d=m.length;d>f;f++){var l=m[f].start(g,c);l?h[f]=[l,m[f].end(g,l)]:h[f]=a.NEVER}}function D(h,s,l,c){for(var g=A(h),d=0,p=s.length;p>d;d++){if(l[d]&&!g(l[d][0],c)){var m=s[d].start(h,c);m?l[d]=[m,s[d].end(h,m)]:l[d]=a.NEVER}}}function K(h,f,l,g){for(var c=0,d=f.length;d>c;c++){l[c]&&l[c].getTime()===g.getTime()&&(l[c]=f[c].start(h,f[c].tick(h,g)))}}function L(l,g,p,h){for(var c,f=0,d=g.length;d>f;f++){if(g[f]&&g[f].getTime()===p.getTime()){var m=l[f].tickStart(p);if(h&&h>m){return h}(!c||m>c)&&(c=m)}}return c}function k(l,g,p){for(var h,c=A(l),f=0,d=g.length;d>f;f++){var m=g[f];!m||c(m[0],p)||m[1]&&!c(m[1],p)||(!h||c(m[1],h))&&(h=m[1])}return h}function G(g,d){for(var h,f=0,c=g.length;c>f;f++){!g[f]||h&&!d(h,g[f][0])||(h=g[f][0])}return h}function M(p,O,h,c,w){for(var l,y=A(p),g=0,m=O.length;m>g;g++){var s=h[g];if(s&&s.getTime()===c.getTime()){var x=O[g].end(p,s);if(w&&(!x||y(x,w))){return w}(!l||y(x,l))&&(l=x)}}return l}function A(c){return"next"===c?function(f,d){return !d||f.getTime()>d.getTime()}:function(f,d){return !f||d.getTime()>f.getTime()}}function F(g,d){for(var h=g[0],f=1,c=g.length;c>f;f++){g[f]&&d(h,g[f])&&(h=g[f])}return h}if(!z){throw new Error("Missing schedule definition.")}if(!z.schedules){throw new Error("Definition must include at least one schedule.")}for(var I=[],e=z.schedules.length,j=[],b=z.exceptions?z.exceptions.length:0,J=0;e>J;J++){I.push(a.compile(z.schedules[J]))}for(var C=0;b>C;C++){j.push(a.compile(z.exceptions[C]))}return{isValid:function(c){return E("next",1,c,c)!==a.NEVER},next:function(f,c,d){return E("next",f||1,c,d)},prev:function(f,c,d){return E("prev",f||1,c,d)},nextRange:function(f,c,d){return E("next",f||1,c,d,!0)},prevRange:function(f,c,d){return E("prev",f||1,c,d,!0)}}},a.setTimeout=function(d,f){function e(){var h=Date.now(),i=c.next(2,h);if(!i[0]){return void (b=void 0)}var g=i[0].getTime()-h;1000>g&&(g=i[1]?i[1].getTime()-h:1000),b=2147483647>g?setTimeout(d,g):setTimeout(e,2147483647)}var b,c=a.schedule(f);return d&&e(),{isDone:function(){return !b},clear:function(){clearTimeout(b)}}},a.setInterval=function(d,f){function e(){c||(d(),b=a.setTimeout(e,f))}if(d){var b=a.setTimeout(e,f),c=b.isDone();return{isDone:function(){return b.isDone()},clear:function(){c=!0,b.clear()}}}},a.date={},a.date.timezone=function(b){a.date.build=b?function(k,h,l,j,f,g){return new Date(k,h,l,j,f,g)}:function(k,h,l,j,f,g){return new Date(Date.UTC(k,h,l,j,f,g))};var d=b?"get":"getUTC",c=Date.prototype;a.date.getYear=c[d+"FullYear"],a.date.getMonth=c[d+"Month"],a.date.getDate=c[d+"Date"],a.date.getDay=c[d+"Day"],a.date.getHour=c[d+"Hours"],a.date.getMin=c[d+"Minutes"],a.date.getSec=c[d+"Seconds"],a.date.isUTC=!b},a.date.UTC=function(){a.date.timezone(!1)},a.date.localTime=function(){a.date.timezone(!0)},a.date.UTC(),a.SEC=1000,a.MIN=60*a.SEC,a.HOUR=60*a.MIN,a.DAY=24*a.HOUR,a.WEEK=7*a.DAY,a.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],a.NEVER=0,a.date.next=function(e,g,f,b,d,c){return a.date.build(e,void 0!==g?g-1:0,void 0!==f?f:1,b||0,d||0,c||0)},a.date.nextRollover=function(e,g,f,b){var d=f.val(e),c=f.extent(e)[1];return d>=(g||c)||g>c?new Date(b.end(e).getTime()+a.SEC):b.start(e)},a.date.prev=function(e,h,f,b,d,c){var g=arguments.length;return h=2>g?11:h-1,f=3>g?a.D.extent(a.date.next(e,h+1))[1]:f,b=4>g?23:b,d=5>g?59:d,c=6>g?59:c,a.date.build(e,h,f,b,d,c)},a.date.prevRollover=function(f,c,g,d){var b=g.val(f);return c>=b||!c?d.start(d.prev(f,d.val(f)-1)):d.start(f)},a.parse={},a.parse.cron=function(z,G){function j(d,c,f){return isNaN(d)?H[d]||null:Math.min(+d+(c||0),f||9999)}function b(d){var c,f={};for(c in d){"dc"!==c&&"d"!==c&&(f[c]=d[c].slice(0))}return f}function D(l,f,m,h,c){var d=m;for(l[f]||(l[f]=[]);h>=d;){l[f].indexOf(d)<0&&l[f].push(d),d+=c||1}l[f].sort(function(n,i){return n-i})}function q(f,d,h,c){(d.d&&!d.dc||d.dc&&d.dc.indexOf(c)<0)&&(f.push(b(d)),d=f[f.length-1]),D(d,"d",h,h),D(d,"dc",c,c)}function F(h,d,l){var f={},c={};1===l?(D(d,"D",1,3),D(d,"d",H.MON,H.FRI),D(f,"D",2,2),D(f,"d",H.TUE,H.FRI),D(c,"D",3,3),D(c,"d",H.TUE,H.FRI)):(D(d,"D",l-1,l+1),D(d,"d",H.MON,H.FRI),D(f,"D",l-1,l-1),D(f,"d",H.MON,H.THU),D(c,"D",l+1,l+1),D(c,"d",H.TUE,H.FRI)),h.exceptions.push(f),h.exceptions.push(c)}function g(x,L,c,n,K,h){var s=x.split("/"),I=+s[1],J=s[0];if("*"!==J&&"0"!==J){var m=J.split("-");n=j(m[0],h,K),K=j(m[1],h,K)||K}D(L,c,n,K,I)}function y(u,K,h,o,x,J){var n,I,L=K.schedules,i=L[L.length-1];"L"===u&&(u=o-1),null!==(n=j(u,J,x))?D(i,h,n,n):null!==(n=j(u.replace("W",""),J,x))?F(K,i,n):null!==(n=j(u.replace("L",""),J,x))?q(L,i,n,o-1):2===(I=u.split("#")).length?(n=j(I[0],J,x),q(L,i,n,j(I[1]))):g(u,i,h,o,x,J)}function A(c){return c.indexOf("#")>-1||c.indexOf("L")>0}function E(d,c){return A(d)&&!A(c)?1:d-c}function p(m){var I,h,c,v,l={schedules:[{}],exceptions:[]},x=m.replace(/(\s)+/g," ").split(" ");for(I in w){if(h=w[I],c=x[h[0]],c&&"*"!==c&&"?"!==c){v=c.split(",").sort(E);var f,s=v.length;for(f=0;s>f;f++){y(v[f],l,I,h[1],h[2],h[3])}}}return l}function B(d){var c=d.toUpperCase();return k[c]||c}var H={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},k={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},w={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]},C=B(z);return p(G?C:"0 "+C)},a.parse.recur=function(){function y(n,i,f){if(n=x?n+"_"+x:n,g||(z.push({}),g=z[0]),g[n]||(g[n]=[]),b=g[n],j){for(q=[],m=i;f>=m;m+=j){q.push(m)}w={n:n,x:j,c:b.length,m:f}}q=e?[i]:k?[f]:q;var o=q.length;for(m=0;o>m;m+=1){var d=q[m];b.indexOf(d)<0&&b.push(d)}q=j=x=e=k=0}var g,b,q,j,x,e,k,m,w,h=[],p=[],z=h;return{schedules:h,exceptions:p,on:function(){return q=arguments[0] instanceof Array?arguments[0]:arguments,this},every:function(c){return j=c||1,this},after:function(c){return x="a",q=[c],this},before:function(c){return x="b",q=[c],this},first:function(){return e=1,this},last:function(){return k=1,this},time:function(){for(var d=0,f=q.length;f>d;d++){var c=q[d].split(":");c.length<3&&c.push(0),q[d]=3600*+c[0]+60*+c[1]+ +c[2]}return y("t"),this},second:function(){return y("s",0,59),this},minute:function(){return y("m",0,59),this},hour:function(){return y("h",0,23),this},dayOfMonth:function(){return y("D",1,k?0:31),this},dayOfWeek:function(){return y("d",1,7),this},onWeekend:function(){return q=[1,7],this.dayOfWeek()},onWeekday:function(){return q=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return y("dc",1,k?0:5),this},dayOfYear:function(){return y("dy",1,k?0:366),this},weekOfMonth:function(){return y("wm",1,k?0:5),this},weekOfYear:function(){return y("wy",1,k?0:53),this},month:function(){return y("M",1,12),this},year:function(){return y("Y",1970,2450),this},fullDate:function(){for(var c=0,d=q.length;d>c;c++){q[c]=q[c].getTime()}return y("fd"),this},customModifier:function(c,f){var d=a.modifier[c];if(!d){throw new Error("Custom modifier "+c+" not recognized!")}return x=c,q=arguments[1] instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(d){var c=a[d];if(!c){throw new Error("Custom time period "+d+" not recognized!")}return y(d,c.extent(new Date)[0],c.extent(new Date)[1]),this},startingOn:function(c){return this.between(c,w.m)},between:function(d,c){return g[w.n]=g[w.n].splice(0,w.c),j=w.x,y(w.n,d,c),this},and:function(){return g=z[z.push({})-1],this},except:function(){return z=p,g=null,this}}},a.parse.text=function(z){function E(f,c,g,d){return{startPos:f,endPos:c,text:g,type:d}}function B(p){var O,c,w,m,y,g,n=p instanceof Array?p:[p],s=/\s+/;for(n.push(s),y=j;!O||O.type===s;){g=-1,c=b.substring(y),O=E(y,y,b.split(s)[0]);var x,h=n.length;for(x=0;h>x;x++){m=n[x],w=m.exec(c),w&&0===w.index&&w[0].length>g&&(g=w[0].length,O=E(y,y+g,c.substring(0,g),m))}O.type===s&&(y=O.endPos)}return O}function N(d){var c=B(d);return j=c.endPos,c}function H(g){for(var d=+A(g),h=G(J.through)?+A(g):d,f=[],c=d;h>=c;c++){f.push(c)}return f}function q(d){for(var c=H(d);G(J.and);){c=c.concat(H(d))}return c}function D(g){var d,h,f,c;G(J.weekend)?g.on(C.sun,C.sat).dayOfWeek():G(J.weekday)?g.on(C.mon,C.tue,C.wed,C.thu,C.fri).dayOfWeek():(d=A(J.rank),g.every(d),h=k(g),G(J.start)?(d=A(J.rank),g.startingOn(d),M(h.type)):G(J.between)&&(f=A(J.rank),G(J.and)&&(c=A(J.rank),g.between(f,c))))}function K(c){G(J.first)?c.first():G(J.last)?c.last():c.on(q(J.rank)),k(c)}function L(d){j=0,b=d,I=-1;for(var c=e();j<b.length&&0>I;){var f=M([J.every,J.after,J.before,J.onthe,J.on,J.of,J["in"],J.at,J.and,J.except,J.also]);switch(f.type){case J.every:D(c);break;case J.after:void 0!==B(J.time).type?(c.after(A(J.time)),c.time()):(c.after(A(J.rank)),k(c));break;case J.before:void 0!==B(J.time).type?(c.before(A(J.time)),c.time()):(c.before(A(J.rank)),k(c));break;case J.onthe:K(c);break;case J.on:c.on(q(J.dayName)).dayOfWeek();break;case J.of:c.on(q(J.monthName)).month();break;case J["in"]:c.on(q(J.yearIndex)).year();break;case J.at:for(c.on(A(J.time)).time();G(J.and);){c.on(A(J.time)).time()}break;case J.and:break;case J.also:c.and();break;case J.except:c.except();break;default:I=j}}return{schedules:c.schedules,exceptions:c.exceptions,error:I}}function k(d){var c=M([J.second,J.minute,J.hour,J.dayOfYear,J.dayOfWeek,J.dayInstance,J.day,J.month,J.year,J.weekOfMonth,J.weekOfYear]);switch(c.type){case J.second:d.second();break;case J.minute:d.minute();break;case J.hour:d.hour();break;case J.dayOfYear:d.dayOfYear();break;case J.dayOfWeek:d.dayOfWeek();break;case J.dayInstance:d.dayOfWeekCount();break;case J.day:d.dayOfMonth();break;case J.weekOfMonth:d.weekOfMonth();break;case J.weekOfYear:d.weekOfYear();break;case J.month:d.month();break;case J.year:d.year();break;default:I=j}return c}function G(d){var c=B(d).type===d;return c&&N(d),c}function M(d){var c=N(d);return c.type?c.text=F(c.text,d):I=j,c}function A(c){return M(c).text}function F(h,f){var l=h;switch(f){case J.time:var g=h.split(/(:|am|pm)/),c="pm"===g[3]&&g[0]<12?parseInt(g[0],10)+12:g[0],d=g[2].trim();l=(1===c.length?"0":"")+c+":"+d;break;case J.rank:l=parseInt(/^\d+/.exec(h)[0],10);break;case J.monthName:case J.dayName:l=C[h.substring(0,3)]}return l}var I,e=a.parse.recur,j=0,b="",J={eof:/^$/,rank:/^((\d+)(st|nd|rd|th)?)\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,"in":/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},C={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,"for":4};return L(z.toLowerCase())},a}();